<!DOCTYPE html>
<html>
  <head>
    <!-- Favicon as generated by realfavicongenerator.net (slightly modified for webpack) -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="favicon/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="favicon/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="favicon/manifest.json">
    <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="favicon/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Mumble">
    <meta name="application-name" content="Mumble">
    <meta name="msapplication-config" content="${require('./favicon/browserconfig.xml')}">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" type="text/css" href="/loading.css">
  </head>
  <body>
    <div class="loading-container" data-bind="css: { loaded: true }">
      <div class="loading-circle" data-bind="css: { loaded: true }"></div>
    </div>

    <div id="container" style="display: none" data-bind="visible: true">
      <!-- ko with: connectDialog --> 
      <div data-bind="visible: visible">
          <form class="connect-dialog" data-bind="submit: connect">
              <input class="connect-dialog-submit" type="submit" value="CONNECT">
          </form>
        </div>
      <!-- /ko -->
      <!-- ko with: settingsDialog -->
      <div class="settings-dialog dialog" data-bind="visible: $data">
          <div class="dialog-header">
            Settings
          </div>
          <form data-bind="submit: $root.applySettings">
            <table>
                <tr>
                  <td>Transmission</td>
                  <td>
                    <select data-bind='value: voiceMode'>
                      <option value="cont">Continuous</option>
                      <option value="vad">Voice Activity</option>
                      <option value="ptt">Push To Talk</option>
                  </td>
                </tr>
                <tr data-bind="visible: voiceMode() == 'vad'">
                  <td colspan="2">
                    <div class="mic-volume-container">
                      <div class="mic-volume" data-bind="style: {
                          width: testVadLevel()*100 + '%',
                          background: testVadActive() ? 'green' : 'red'
                        }"></div>
                    </div>
                    <input type="range" min="0" max="1" step="0.01"
                           data-bind="value: vadLevel">
                  </td>
                </tr>
                <tr data-bind="visible: voiceMode() == 'ptt'">
                  <td>PTT Key</td>
                  <td>
                    <input type="button" data-bind="value: pttKeyDisplay, click: recordPttKey">
                  </td>
                </tr>
            </table>
            <div class="dialog-footer">
              <input class="dialog-close" type="button" data-bind="click: $root.closeSettings" value="Cancel">
              <input class="dialog-submit" type="submit" value="Apply">
            </div>
          </form>
        </div>
      <!-- /ko -->
      <script type="text/html" id="user-tag">
        <span class="user-tag" data-bind="text: name"></span>
      </script>
      <script type="text/html" id="channel-tag">
        <span class="channel-tag" data-bind="text: name"></span>
      </script>

      <!-- Toolbar -->
      <div class="toolbar">
        <img class="handle-horizontal" src="/svg/handle_horizontal.svg">
        <img class="handle-vertical" src="/svg/handle_horizontal.svg">
        <img class="tb-connect" data-bind="click: connectDialog.show"
                      rel="connect" src="/svg/applications-internet.svg">
        <div class="divider"></div>
        <img class="tb-mute" data-bind="visible: !selfMute(),
                              click: function () { requestMute(thisUser) }"
                      rel="mute" src="/svg/audio-input-microphone.svg">
        <img class="tb-unmute tb-active" data-bind="visible: selfMute,
                              click: function () { requestUnmute(thisUser) }"
                      rel="unmute" src="/svg/audio-input-microphone-muted.svg">
        <img class="tb-deaf" data-bind="visible: !selfDeaf(),
                              click: function () { requestDeaf(thisUser) }"
                      rel="deaf" src="/svg/audio-output.svg">
        <img class="tb-undeaf tb-active" data-bind="visible: selfDeaf,
                              click: function () { requestUndeaf(thisUser) }"
                      rel="undeaf" src="/svg/audio-output-deafened.svg">
        <div class="divider"></div>
        
        <img class="tb-sourcecode" data-bind="click: openSourceCode"
                      rel="Source Code" src="/svg/source-code.svg">
      </div>
      
      <!-- Channel -->
      <script type="text/html" id="channel">
        <div class="channel" data-bind="
            dblclick: $root.select, 
            event: {
              click: $root.requestMove.bind($root, $root.thisUser())
            },
            css: {
              selected: $root.selected() === $data,
              currentChannel: users.indexOf($root.thisUser()) !== -1
            }">
          <div class="channel-status">
            <img class="channel-description" data-bind="visible: description"
                alt="description" src="/svg/comment.svg">
          </div>
          <div data-bind="if: description">
            <div class="channel-description tooltip" data-bind="html: description"></div>
          </div>
          <img class="channel-icon" src="/svg/channel.svg"
            data-bind="visible: !linked() && $root.thisUser().channel() !== $data">
          <img class="channel-icon-active" src="/svg/channel_active.svg"
            data-bind="visible: $root.thisUser().channel() === $data">
          <img class="channel-icon-linked" src="/svg/channel_linked.svg"
            data-bind="visible: linked() && $root.thisUser().channel() !== $data">
          <div class="channel-name" data-bind="text: name"></div>
        </div>
        <!-- ko if: expanded -->
        <!-- ko foreach: users -->
        <div class="user-wrapper">
          <div class="user-tree"></div>
          <div class="user" data-bind="
                click: $root.select,
                css: {
                  thisClient: $root.thisUser() === $data,
                  selected: $root.selected() === $data
                }">
            <div class="user-status" data-bind="attr: { title: state }">
              <img class="user-comment" data-bind="visible: comment"
                  alt="comment" src="/svg/comment.svg">
              <img class="user-server-mute" data-bind="visible: mute"
                  alt="server mute" src="/svg/muted_server.svg">
              <img class="user-suppress-mute" data-bind="visible: suppress"
                  alt="suppressed" src="/svg/muted_suppressed.svg">
              <img class="user-self-mute" data-bind="visible: selfMute" 
                  alt="self mute" src="/svg/muted_self.svg">
              <img class="user-server-deaf" data-bind="visible: deaf"
                  alt="server deaf" src="/svg/deafened_server.svg">
              <img class="user-self-deaf" data-bind="visible: selfDeaf"
                  alt="self deaf" src="/svg/deafened_self.svg">
              <img class="user-authenticated" data-bind="visible: uid"
                  alt="authenticated" src="/svg/authenticated.svg">
            </div>
            <div data-bind="if: comment">
              <div class="user-comment tooltip" data-bind="html: comment"></div>
            </div>
            <img class="user-talk-off" data-bind="visible: talking() == 'off'"
                alt="talk off" src="/svg/talking_off.svg">
            <img class="user-talk-on" data-bind="visible: talking() == 'on'"
                alt="talk on" src="/svg/talking_on.svg">
            <img class="user-talk-whisper" data-bind="visible: talking() == 'whisper'"
                alt="whisper" src="/svg/talking_whisper.svg">
            <img class="user-talk-shout" data-bind="visible: talking() == 'shout'"
                alt="shout" src="/svg/talking_alt.svg">
            <div class="user-name" data-bind="text: name"></div>
          </div>
        </div>
        <!-- /ko -->
        <!-- ko foreach: channels -->
        <div class="channel-wrapper">
          <!-- ko ifnot: users().length || channels().length -->
          <div class="channel-tree"></div>
          <!-- /ko -->
          
            <img class="branch-open" src="/svg/branch_open.svg"
                data-bind="click: expanded.bind($data, false), visible: expanded()">
            <img class="branch-closed" src="/svg/branch_closed.svg"
                data-bind="click: expanded.bind($data, true), visible: !expanded()">         
          <div class="channel-sub" data-bind="template: {name: 'channel', data: $data}"></div>
        </div>
        <!-- /ko -->
        <!-- /ko -->
      </script>
      <div class="channel-root-container" data-bind="if: root">
        <div class="channel-root" data-bind="template: {name: 'channel', data: root}"></div>
      </div>
      <!-- Talk button -->
      <div class="talk-button":active type="button" id="talk-state" data-bind="event: {touchstart: talkPushed, touchend: talkReleased, mousedown: talkPushed, mouseup: talkReleased}">PUSH TO TALK</div>
    </div>
  </body>
  <link rel="stylesheet" type="text/css" href="/main.css">
  <script src="index.js"></script>
</html>
